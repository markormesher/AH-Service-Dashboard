// Generated by CoffeeScript 1.9.3
(function() {
  var addToTicker, clockCycle, getBackgroundDiv, getCenterDiv, getDateOrd, getGuid, getMonthName, getNote, getTickerWidths, guidCount, initNotes, loadNote, loadTickerText, load_clock, load_dial, load_identify, load_ticker, notes, readCleanLines, reloadDataIframe, setNoteTitle, tickerLeft, tickerMove, tickerRunning, tickerSeparator, tickerWidth, tickerWrapperWidth;

  window._DATA = {};

  window._SOURCES = {};

  window.onmessage = function(e) {
    var i, name, ref, ref1, results, waiting;
    if ((e != null ? (ref = e.data) != null ? ref.sender : void 0 : void 0) !== 'self') {
      return;
    }
    window._DATA[e.data.source] = e.data.data;
    ref1 = window._SOURCES;
    results = [];
    for (name in ref1) {
      waiting = ref1[name];
      if (e.data.source === name) {
        results.push((function() {
          var j, len, results1;
          results1 = [];
          for (j = 0, len = waiting.length; j < len; j++) {
            i = waiting[j];
            results1.push(initNotes(i));
          }
          return results1;
        })());
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  reloadDataIframe = function() {
    $('#js-iframe').attr('src', 'js.html');
    return setTimeout(reloadDataIframe, 5000);
  };

  setTimeout(reloadDataIframe, 2000);

  guidCount = 1;

  getGuid = function() {
    return ++guidCount;
  };

  window.sourceLoaded = function(s) {
    var j, len, n, results, waiting;
    waiting = window._SOURCES[s];
    if ($.isArray(waiting)) {
      results = [];
      for (j = 0, len = waiting.length; j < len; j++) {
        n = waiting[j];
        results.push(initNotes(n));
      }
      return results;
    }
  };

  readCleanLines = function(source) {
    var r, raw;
    raw = window._DATA[source].split("\n");
    return (function() {
      var j, len, results;
      results = [];
      for (j = 0, len = raw.length; j < len; j++) {
        r = raw[j];
        if (r.trim().length > 0 && r.substr(0, 2) !== '--') {
          results.push(r.trim());
        }
      }
      return results;
    })();
  };

  getNote = function(i) {
    return $('div#note-' + i);
  };

  getBackgroundDiv = function(note) {
    note.html('<div class="note-extra-bg"></div>');
    return note.find('.note-extra-bg');
  };

  getCenterDiv = function(note, full) {
    if (full == null) {
      full = true;
    }
    note.addClass('note-center-outer' + (full ? '-full' : ''));
    note.html(note.html() + '<div class="note-center-inner"></div>');
    return note.find('.note-center-inner');
  };

  setNoteTitle = function(note, title) {
    return note.html(note.html() + '<p class="note-title">' + title + '</p>');
  };

  notes = [
    {
      id: 0,
      job: 'ticker',
      data: 'news-ticker'
    }, {
      id: 1,
      job: 'clock',
      data: null
    }, {
      id: 2,
      job: 'identify',
      data: null
    }, {
      id: 3,
      job: 'identify',
      data: null
    }, {
      id: 4,
      job: 'dial',
      data: 'dial-1'
    }, {
      id: 5,
      job: 'dial',
      data: 'dial-2'
    }, {
      id: 6,
      job: 'identify',
      data: null
    }, {
      id: 7,
      job: 'identify',
      data: null
    }, {
      id: 8,
      job: 'identify',
      data: null
    }, {
      id: 9,
      job: 'identify',
      data: null
    }, {
      id: 10,
      job: 'identify',
      data: null
    }, {
      id: 11,
      job: 'identify',
      data: null
    }
  ];

  $(document).ready(function() {
    return initNotes();
  });

  initNotes = function(n) {
    var data, i, ref, ref1, results;
    if (n == null) {
      n = -1;
    }
    if (n >= 0) {
      loadNote(notes[n].id, notes[n].job, (ref = notes[n]) != null ? ref.data : void 0);
      return;
    }
    i = 0;
    results = [];
    while (true) {
      data = (ref1 = notes[i]) != null ? ref1.data : void 0;
      if (data === null) {
        loadNote(notes[i].id, notes[i].job, null);
      } else {
        if ($.isArray(window._SOURCES[data])) {
          window._SOURCES[data][window._SOURCES[data].length] = i;
        } else {
          window._SOURCES[data] = [i];
        }
      }
      ++i;
      if (i === notes.length) {
        break;
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  loadNote = function(id, role, data) {
    switch (role) {
      case 'ticker':
        return load_ticker();
      case 'identify':
        return load_identify(id);
      case 'clock':
        return load_clock(id);
      case 'dial':
        return load_dial(id, data);
    }
  };

  load_identify = function(id) {
    var center, note;
    note = getNote(id);
    center = getCenterDiv(note);
    return center.html(id);
  };

  load_clock = function(id) {
    var bg, center, note;
    note = getNote(id);
    bg = getBackgroundDiv(note);
    bg.css('background-image', 'url("images/clock-bg.png")');
    bg.css('background-size', 'auto 85%');
    center = getCenterDiv(bg);
    center.html('<p class="clock-time"</p><p class="clock-date"></p>');
    return clockCycle();
  };

  clockCycle = function() {
    var d, date, h, m, now, time;
    now = new Date();
    h = now.getHours();
    m = now.getMinutes();
    if (h < 10) {
      h = '0' + h;
    }
    if (m < 10) {
      m = '0' + m;
    }
    time = h + ':' + m;
    d = now.getDate();
    m = now.getMonth();
    date = d + getDateOrd(d) + " " + getMonthName(m);
    $('.clock-time').html(time);
    $('.clock-date').html(date);
    return setTimeout(clockCycle, 500);
  };

  getDateOrd = function(n) {
    var m, ordinals;
    ordinals = [false, 'st', 'nd', 'rd'];
    m = n % 100;
    if (m > 10 && m < 14) {
      return 'th';
    } else {
      return ordinals[m % 10] || 'th';
    }
  };

  getMonthName = function(n) {
    var months;
    months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    return months[n];
  };

  load_dial = function(id, data) {
    var center, knobGuid, note, values;
    values = readCleanLines(data);
    note = getNote(id);
    note.html('');
    center = getCenterDiv(note, false);
    setNoteTitle(center, values[0]);
    knobGuid = getGuid();
    center.html(center.html() + '<input type="text" id="knob-' + knobGuid + '">');
    return $('#knob-' + knobGuid).val(values[3]).knob({
      width: 110,
      angleArc: 250,
      angleOffset: -125,
      fgColor: '#ffffff',
      bgColor: 'rgba(255, 255, 255, 0.3)',
      readOnly: true,
      displayPrevious: true,
      min: values[1],
      max: values[2]
    });
  };

  tickerWidth = tickerWrapperWidth = tickerLeft = 0;

  tickerSeparator = '<span>&nbsp;&nbsp;&bull;&nbsp;&nbsp;</span>';

  tickerRunning = false;

  load_ticker = function() {
    if (tickerRunning) {
      return;
    }
    tickerRunning = true;
    loadTickerText();
    getTickerWidths();
    return tickerMove();
  };

  getTickerWidths = function() {
    tickerWidth = $('.ticker-text').width();
    return tickerWrapperWidth = $('.ticker').width();
  };

  loadTickerText = function() {
    var i, j, len, lines, r, results;
    $('.ticker-text').html('');
    lines = readCleanLines('news-ticker');
    results = [];
    for (i = j = 0, len = lines.length; j < len; i = ++j) {
      r = lines[i];
      results.push(addToTicker(r, i));
    }
    return results;
  };

  addToTicker = function(r, i) {
    var tickerText;
    tickerText = $('.ticker-text');
    if (i > 0) {
      tickerText.html(tickerText.html() + tickerSeparator);
    }
    return tickerText.html(tickerText.html() + r);
  };

  tickerMove = function() {
    if (--tickerLeft < -tickerWidth) {
      loadTickerText();
      getTickerWidths();
      tickerLeft = tickerWrapperWidth;
    }
    $('.ticker-text').css('margin-left', tickerLeft + 'px');
    return setTimeout(tickerMove, 16);
  };

}).call(this);

//# sourceMappingURL=tasks.js.map
